<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>è„³ãƒˆãƒ¬ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body {
      margin: 0;
      background: #0f172a;
      color: #f9fafb;
      display: flex;
      justify-content: center;
    }
    .container {
      max-width: 900px;
      width: 100%;
      padding: 16px;
    }
    header {
      text-align: center;
      margin-bottom: 12px;
    }
    header h1 {
      margin: 0 0 4px;
      font-size: 1.8rem;
    }
    header p {
      margin: 0;
      font-size: 0.9rem;
      color: #cbd5f5;
    }
    .top-nav {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      justify-content: center;
      margin-bottom: 12px;
    }
    button {
      border: none;
      border-radius: 999px;
      padding: 8px 14px;
      cursor: pointer;
      font-size: 0.9rem;
      background: #1d4ed8;
      color: #f9fafb;
      transition: transform 0.07s ease, box-shadow 0.07s ease, background 0.15s;
      box-shadow: 0 2px 4px rgba(15,23,42,0.4);
    }
    button:hover:not(:disabled) {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(15,23,42,0.6);
      background: #2563eb;
    }
    button:active:not(:disabled) {
      transform: translateY(0);
      box-shadow: 0 1px 2px rgba(15,23,42,0.8);
    }
    button:disabled {
      opacity: 0.6;
      cursor: default;
      box-shadow: none;
    }

    main {
      background: rgba(15,23,42,0.85);
      border-radius: 16px;
      padding: 16px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.5);
      border: 1px solid rgba(148,163,184,0.3);
    }
    .screen {
      display: none;
    }
    .screen.active {
      display: block;
    }
    h2 {
      margin-top: 0;
      font-size: 1.4rem;
    }
    h3 {
      margin-top: 1.2rem;
      font-size: 1.1rem;
    }
    .game-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px;
      margin-top: 8px;
    }
    .game-card {
      background: #020617;
      border-radius: 14px;
      padding: 12px;
      border: 1px solid rgba(148,163,184,0.3);
    }
    .game-card h3 {
      margin-top: 0;
    }
    .tag {
      display: inline-block;
      font-size: 0.75rem;
      padding: 2px 8px;
      border-radius: 999px;
      background: rgba(59,130,246,0.15);
      color: #bfdbfe;
      margin-bottom: 4px;
    }
    .muted {
      color: #94a3b8;
      font-size: 0.9rem;
    }
    .home-btn {
      margin-top: 10px;
      background: #0f766e;
    }
    .ranking-list {
      padding-left: 20px;
      font-size: 0.9rem;
    }
    .ranking-list li {
      margin-bottom: 2px;
    }
    .status-row {
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
      margin-bottom: 6px;
    }
    input[type="number"],
    input[type="text"] {
      width: 100%;
      padding: 8px;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      background: #020617;
      color: #e5e7eb;
      font-size: 0.95rem;
      box-sizing: border-box;
      margin: 6px 0;
    }
    input:disabled {
      opacity: 0.6;
    }
    .button-row {
      display: flex;
      gap: 8px;
      margin-top: 4px;
      flex-wrap: wrap;
    }
    .emphasis {
      font-weight: 600;
      color: #fbbf24;
    }
    /* Reaction game */
    #reaction-box {
      text-align: center;
      padding: 16px;
      border-radius: 12px;
      background: #111827;
      transition: background 0.2s;
    }
    #reaction-box.go {
      background: #15803d;
    }
    #reaction-message {
      margin-bottom: 8px;
    }
    #reaction-result {
      margin-top: 8px;
      font-size: 1rem;
    }
    /* Memory game */
    #memory-board {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
      margin: 8px 0 10px;
    }
    .memory-tile {
      height: 70px;
      border-radius: 10px;
      border: none;
      cursor: pointer;
      opacity: 0.8;
      transition: transform 0.08s, opacity 0.08s, box-shadow 0.08s;
    }
    .memory-tile.active {
      transform: scale(1.05);
      opacity: 1;
      box-shadow: 0 0 12px rgba(250,250,250,0.7);
    }
    .memory-tile[data-index="0"] {
      background: #ef4444;
    }
    .memory-tile[data-index="1"] {
      background: #22c55e;
    }
    .memory-tile[data-index="2"] {
      background: #3b82f6;
    }
    .memory-tile[data-index="3"] {
      background: #eab308;
    }
    #memory-level {
      font-weight: 600;
    }
    @media (max-width: 600px) {
      main {
        padding: 12px;
      }
      header h1 {
        font-size: 1.4rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>è„³ãƒˆãƒ¬ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ ğŸ§ ğŸ‰</h1>
      <p>åå°„ãƒ»è¨ˆç®—ãƒ»è¨˜æ†¶åŠ›ã§ãƒã‚¤ã‚¹ã‚³ã‚¢ã‚’ã­ã‚‰ãˆï¼ ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã§å‹é”ã¨å‹è² ã—ã‚ˆã†ã€‚</p>
    </header>

    <nav class="top-nav">
      <button data-target="screen-home">ğŸ  ãƒ›ãƒ¼ãƒ </button>
      <button data-target="screen-reaction">âš¡ åå°„ç¥çµŒ</button>
      <button data-target="screen-calc">â— è¨ˆç®—ãƒãƒ£ãƒ¬ãƒ³ã‚¸</button>
      <button data-target="screen-memory">ğŸ§© è¨˜æ†¶åŠ›</button>
    </nav>

    <main>
      <!-- ãƒ›ãƒ¼ãƒ ç”»é¢ -->
      <section id="screen-home" class="screen active">
        <h2>ã‚²ãƒ¼ãƒ ã‚’ãˆã‚‰ã‚“ã§ã‚¹ã‚¿ãƒ¼ãƒˆï¼</h2>
        <p class="muted">
          ãã‚Œãã‚Œã®ã‚²ãƒ¼ãƒ ã®çµæœã¯ãƒ–ãƒ©ã‚¦ã‚¶å†…ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚<br />
          ã‚¯ãƒ©ã‚¹å…¨å“¡ã§åŒã˜ç«¯æœ«ã‚’ä½¿ãˆã°ã€ç°¡æ˜“ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã¨ã—ã¦ç››ã‚Šä¸ŠãŒã‚Œã¾ã™ã€‚
        </p>
        <div class="game-grid">
          <div class="game-card">
            <span class="tag">åå°„</span>
            <h3>âš¡ åå°„ç¥çµŒã‚²ãƒ¼ãƒ </h3>
            <p class="muted">ç”»é¢ãŒã€Œä»Šã ï¼ã€ã«ãªã£ãŸç¬é–“ã«ã‚¯ãƒªãƒƒã‚¯ã€‚<span class="emphasis">æœ€é€Ÿåå¿œæ™‚é–“</span>ã‚’ãããŠã†ã€‚</p>
            <button data-target="screen-reaction">ã“ã®ã‚²ãƒ¼ãƒ ã§éŠã¶</button>
          </div>
          <div class="game-card">
            <span class="tag">è¨ˆç®—</span>
            <h3>â— è¨ˆç®—ãƒãƒ£ãƒ¬ãƒ³ã‚¸</h3>
            <p class="muted">30ç§’ã®ã‚ã„ã ã«ã€ã§ãã‚‹ã ã‘å¤šãã®è¨ˆç®—å•é¡Œã‚’è§£ã“ã†ã€‚é›†ä¸­åŠ›ã¨ã‚¹ãƒ”ãƒ¼ãƒ‰ãŒã‚«ã‚®ï¼</p>
            <button data-target="screen-calc">ã“ã®ã‚²ãƒ¼ãƒ ã§éŠã¶</button>
          </div>
          <div class="game-card">
            <span class="tag">è¨˜æ†¶</span>
            <h3>ğŸ§© è¨˜æ†¶åŠ›ã‚²ãƒ¼ãƒ </h3>
            <p class="muted">å…‰ã‚‹ãƒã‚¹ã®é †ç•ªã‚’ãŠã¼ãˆã¦ã€åŒã˜ã‚ˆã†ã«ã‚¿ãƒƒãƒ—ã€‚ä½•ãƒ¬ãƒ™ãƒ«ã¾ã§ã„ã‘ã‚‹ã‹ãªï¼Ÿ</p>
            <button data-target="screen-memory">ã“ã®ã‚²ãƒ¼ãƒ ã§éŠã¶</button>
          </div>
        </div>
      </section>

      <!-- åå°„ç¥çµŒã‚²ãƒ¼ãƒ  -->
      <section id="screen-reaction" class="screen">
        <h2>âš¡ åå°„ç¥çµŒã‚²ãƒ¼ãƒ </h2>
        <p class="muted">
          ã€Œã‚¹ã‚¿ãƒ¼ãƒˆã€ã‚’æŠ¼ã™ã¨ã€å°‘ã—ã—ã¦ã‹ã‚‰ç”»é¢ãŒ<span class="emphasis">ç·‘è‰²</span>ã«ãªã‚Šã¾ã™ã€‚<br />
          ç·‘ã«ãªã£ãŸã‚‰ã€ã§ãã‚‹ã ã‘æ—©ãã€Œä»Šã ï¼ã‚¯ãƒªãƒƒã‚¯ï¼ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ãã†ã€‚<br />
          ãƒ•ãƒ©ã‚¤ãƒ³ã‚°ã™ã‚‹ã¨ã‚„ã‚Šç›´ã—ï¼
        </p>

        <div class="game-card" id="reaction-box">
          <p id="reaction-message">æº–å‚™OKï¼Ÿã€Œã‚¹ã‚¿ãƒ¼ãƒˆã€ã‚’æŠ¼ã—ã¦ã­ã€‚</p>
          <button id="reaction-start-btn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
          <button id="reaction-click-btn" disabled>ä»Šã ï¼ã‚¯ãƒªãƒƒã‚¯ï¼</button>
          <p id="reaction-result"></p>
        </div>

        <button class="home-btn" data-target="screen-home">ğŸ  ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹</button>

        <h3>âš¡ åå°„ç¥çµŒãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆå°ã•ã„ã»ã©ã‚¹ã‚´ã‚¤ï¼‰</h3>
        <p id="no-ranking-reaction" class="muted">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ç›®æŒ‡ã›ç¥åå¿œï¼</p>
        <ol id="ranking-reaction" class="ranking-list"></ol>
      </section>

      <!-- è¨ˆç®—ãƒãƒ£ãƒ¬ãƒ³ã‚¸ -->
      <section id="screen-calc" class="screen">
        <h2>â— è¨ˆç®—ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼ˆ30ç§’ï¼‰</h2>
        <p class="muted">
          ã€Œã‚¹ã‚¿ãƒ¼ãƒˆã€ã‚’æŠ¼ã™ã¨30ç§’ã®ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ãŒå§‹ã¾ã‚Šã¾ã™ã€‚<br />
          å‡ºã¦ãã‚‹ãŸã—ç®—ãƒ»ã²ãç®—ã‚’ã©ã‚“ã©ã‚“è§£ã„ã¦ã€<span class="emphasis">æ­£è§£æ•°</span>ã§å‹è² ã—ã‚ˆã†ï¼
        </p>

        <div class="game-card">
          <div class="status-row">
            <span>æ®‹ã‚Šæ™‚é–“ï¼š<span id="calc-time">30</span> ç§’</span>
            <span>æ­£è§£æ•°ï¼š<span id="calc-score">0</span></span>
          </div>

          <div id="calc-question-area" style="font-size:1.3rem; margin: 8px 0;">
            <span id="calc-question">ã€Œã‚¹ã‚¿ãƒ¼ãƒˆã€ã‚’æŠ¼ã—ã¦ã‚²ãƒ¼ãƒ é–‹å§‹ï¼</span>
          </div>

          <input id="calc-answer" type="number" placeholder="ã“ã“ã«ç­”ãˆã‚’å…¥åŠ›ï¼ˆEnterã§ã‚‚OKï¼‰" disabled />
          <div class="button-row">
            <button id="calc-start-btn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
            <button id="calc-submit-btn" disabled>å›ç­”</button>
          </div>
          <p id="calc-message" class="muted"></p>
        </div>

        <button class="home-btn" data-target="screen-home">ğŸ  ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹</button>

        <h3>â— è¨ˆç®—ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆå¤šã„ã»ã©ã‚¹ã‚´ã‚¤ï¼‰</h3>
        <p id="no-ranking-calc" class="muted">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã¾ãšã¯1å•ç›®ã‹ã‚‰ï¼</p>
        <ol id="ranking-calc" class="ranking-list"></ol>
      </section>

      <!-- è¨˜æ†¶åŠ›ã‚²ãƒ¼ãƒ  -->
      <section id="screen-memory" class="screen">
        <h2>ğŸ§© è¨˜æ†¶åŠ›ã‚²ãƒ¼ãƒ </h2>
        <p class="muted">
          ã€Œã‚¹ã‚¿ãƒ¼ãƒˆã€ã‚’æŠ¼ã™ã¨ã€è‰²ã®ãƒã‚¹ãŒé †ç•ªã«å…‰ã‚Šã¾ã™ã€‚<br />
          å…‰ã£ãŸé †ç•ªã©ãŠã‚Šã«ãƒã‚¹ã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã­ã€‚<br />
          1å›ã§ã‚‚ã¾ã¡ãŒãˆã‚‹ã¨ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ã€‚ã©ã“ã¾ã§ãƒ¬ãƒ™ãƒ«ã‚’ä¼¸ã°ã›ã‚‹ã‹ãªï¼Ÿ
        </p>

        <div class="game-card">
          <div id="memory-board">
            <button class="memory-tile" data-index="0"></button>
            <button class="memory-tile" data-index="1"></button>
            <button class="memory-tile" data-index="2"></button>
            <button class="memory-tile" data-index="3"></button>
          </div>
          <p>åˆ°é”ãƒ¬ãƒ™ãƒ«ï¼š<span id="memory-level">0</span></p>
          <button id="memory-start-btn">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
          <p id="memory-message" class="muted">ã¾ãšã¯ã€Œã‚¹ã‚¿ãƒ¼ãƒˆã€ã‚’æŠ¼ã—ã¦ã­ã€‚</p>
        </div>

        <button class="home-btn" data-target="screen-home">ğŸ  ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹</button>

        <h3>ğŸ§© è¨˜æ†¶åŠ›ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆãƒ¬ãƒ™ãƒ«ãŒé«˜ã„ã»ã©ã‚¹ã‚´ã‚¤ï¼‰</h3>
        <p id="no-ranking-memory" class="muted">ã¾ã è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“ã€‚é ­ã®ã‚¹ãƒˆãƒ¬ãƒƒãƒã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆï¼</p>
        <ol id="ranking-memory" class="ranking-list"></ol>
      </section>
    </main>
  </div>

  <script>
    // ===== ç”»é¢åˆ‡ã‚Šæ›¿ãˆ =====
    const screens = document.querySelectorAll(".screen");
    function showScreen(id) {
      screens.forEach((s) => s.classList.remove("active"));
      const target = document.getElementById(id);
      if (target) target.classList.add("active");
    }
    document.querySelectorAll("[data-target]").forEach((btn) => {
      btn.addEventListener("click", () => {
        const id = btn.getAttribute("data-target");
        showScreen(id);
      });
    });

    // ===== ãƒ©ãƒ³ã‚­ãƒ³ã‚°ç®¡ç† =====
    const RANKING_KEY = "brainTrainerRankings_v1";
    let rankings = {};

    function loadRankings() {
      try {
        const saved = localStorage.getItem(RANKING_KEY);
        if (saved) {
          rankings = JSON.parse(saved);
        }
      } catch (e) {
        console.warn("ãƒ©ãƒ³ã‚­ãƒ³ã‚°èª­ã¿è¾¼ã¿å¤±æ•—:", e);
        rankings = {};
      }
    }

    function saveRankings() {
      try {
        localStorage.setItem(RANKING_KEY, JSON.stringify(rankings));
      } catch (e) {
        console.warn("ãƒ©ãƒ³ã‚­ãƒ³ã‚°ä¿å­˜å¤±æ•—:", e);
      }
    }

    function addScore(gameId, name, score, higherIsBetter) {
      if (!rankings[gameId]) rankings[gameId] = [];
      rankings[gameId].push({ name, score });

      rankings[gameId].sort((a, b) => {
        return higherIsBetter ? b.score - a.score : a.score - b.score;
      });

      rankings[gameId] = rankings[gameId].slice(0, 10);
      saveRankings();
      renderRanking(gameId);
    }

    function renderRanking(gameId) {
      const list = document.getElementById(`ranking-${gameId}`);
      const noMsg = document.getElementById(`no-ranking-${gameId}`);
      if (!list) return;
      list.innerHTML = "";

      const data = rankings[gameId] || [];
      if (!data.length) {
        if (noMsg) noMsg.style.display = "block";
        return;
      }
      if (noMsg) noMsg.style.display = "none";

      data.forEach((entry, index) => {
        const li = document.createElement("li");
        let medal = "";
        if (index === 0) medal = "ğŸ‘‘ ";
        else if (index === 1) medal = "ğŸ¥ˆ ";
        else if (index === 2) medal = "ğŸ¥‰ ";

        let unit = "";
        if (gameId === "reaction") unit = " ms";
        if (gameId === "calc") unit = " å•";
        if (gameId === "memory") unit = " ãƒ¬ãƒ™ãƒ«";

        li.textContent = `${medal}${index + 1}ä½: ${entry.name} - ${entry.score}${unit}`;
        list.appendChild(li);
      });
    }

    function askNameAndSave(gameId, score, higherIsBetter) {
      let comment = "";
      if (gameId === "reaction") {
        if (score < 150) comment = "ç¥é€Ÿï¼äººé–“é›¢ã‚Œã—ãŸåå°„ç¥çµŒï¼";
        else if (score < 250) comment = "ã‹ãªã‚Šé€Ÿã„ï¼ãƒŠã‚¤ã‚¹é›†ä¸­ï¼";
        else comment = "ã¾ãšã¯ã“ã“ã‹ã‚‰ã€‚ã‚‚ã†ä¸€å›ã‚„ã£ã¦ã¿ã‚ˆã†ï¼";
      } else if (gameId === "calc") {
        if (score >= 20) comment = "å¤©æ‰ç´šã®è¨ˆç®—åŠ›ï¼";
        else if (score >= 10) comment = "ã„ã„ãƒšãƒ¼ã‚¹ï¼ãã®èª¿å­ï¼";
        else comment = "ã‚¦ã‚©ãƒ¼ãƒŸãƒ³ã‚°ã‚¢ãƒƒãƒ—ã¯ã“ã“ã‹ã‚‰ï¼";
      } else if (gameId === "memory") {
        if (score >= 10) comment = "ã™ã”ã„è¨˜æ†¶åŠ›ï¼";
        else if (score >= 5) comment = "é›†ä¸­ã§ãã¦ã‚‹ï¼";
        else comment = "ç¶šã‘ã‚Œã°ã‚‚ã£ã¨ä¼¸ã³ã‚‹ã‚ˆï¼";
      }
      if (comment) {
        alert(comment);
      }

      const name = prompt("ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«ç™»éŒ²ã™ã‚‹åå‰ã‚’å…¥åŠ›ã—ã¦ã­ï¼ˆã‚­ãƒ£ãƒ³ã‚»ãƒ«ã§ã‚¹ã‚­ãƒƒãƒ—ï¼‰");
      if (name && name.trim()) {
        addScore(gameId, name.trim(), score, higherIsBetter);
        alert("ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã«ç™»éŒ²ã—ãŸã‚ˆï¼");
      }
    }

    // ===== åå°„ç¥çµŒã‚²ãƒ¼ãƒ  =====
    (function setupReactionGame() {
      const box = document.getElementById("reaction-box");
      const message = document.getElementById("reaction-message");
      const result = document.getElementById("reaction-result");
      const startBtn = document.getElementById("reaction-start-btn");
      const clickBtn = document.getElementById("reaction-click-btn");

      let state = "idle"; // idle | waiting | go
      let timeoutId = null;
      let startTime = 0;

      function resetReaction() {
        state = "idle";
        startBtn.disabled = false;
        clickBtn.disabled = true;
        box.classList.remove("go");
        if (timeoutId) clearTimeout(timeoutId);
      }

      startBtn.addEventListener("click", () => {
        resetReaction();
        state = "waiting";
        startBtn.disabled = true;
        clickBtn.disabled = false;
        result.textContent = "";
        message.textContent = "è‰²ãŒå¤‰ã‚ã‚‹ã¾ã§ã˜ã£ã¨å¾…ã£ã¦â€¦ ãƒ•ãƒ©ã‚¤ãƒ³ã‚°ç¦æ­¢ï¼";

        const delay = 1500 + Math.random() * 2000; // 1.5ã€œ3.5ç§’
        timeoutId = setTimeout(() => {
          state = "go";
          box.classList.add("go");
          message.textContent = "ä»Šã ï¼ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ï¼";
          startTime = performance.now();
        }, delay);
      });

      clickBtn.addEventListener("click", () => {
        if (state === "waiting") {
          message.textContent = "ãƒ•ãƒ©ã‚¤ãƒ³ã‚°ï¼æ®‹å¿µâ€¦ ã‚‚ã†ä¸€å›ãƒãƒ£ãƒ¬ãƒ³ã‚¸ã—ã‚ˆã†ã€‚";
          result.textContent = "";
          resetReaction();
          return;
        }
        if (state === "go") {
          const endTime = performance.now();
          const diff = Math.round(endTime - startTime);
          result.textContent = `åå¿œæ™‚é–“ï¼š${diff} ms`;
          message.textContent = "è¨˜éŒ²ã‚’æ›´æ–°ã§ãã‚‹ã‹ãªï¼Ÿ ã‚‚ã†ä¸€å›ã€Œã‚¹ã‚¿ãƒ¼ãƒˆã€ã—ã¦ã¿ã‚ˆã†ã€‚";
          askNameAndSave("reaction", diff, false);
          resetReaction();
        }
      });
    })();

    // ===== è¨ˆç®—ãƒãƒ£ãƒ¬ãƒ³ã‚¸ =====
    (function setupCalcGame() {
      const timeEl = document.getElementById("calc-time");
      const scoreEl = document.getElementById("calc-score");
      const questionEl = document.getElementById("calc-question");
      const answerInput = document.getElementById("calc-answer");
      const startBtn = document.getElementById("calc-start-btn");
      const submitBtn = document.getElementById("calc-submit-btn");
      const msg = document.getElementById("calc-message");

      let remaining = 30;
      let score = 0;
      let currentAnswer = null;
      let timerId = null;
      let playing = false;

      function updateDisplay() {
        timeEl.textContent = remaining;
        scoreEl.textContent = score;
      }

      function makeQuestion() {
        const a = Math.floor(Math.random() * 20) + 1; // 1ã€œ20
        const b = Math.floor(Math.random() * 20) + 1;
        const usePlus = Math.random() < 0.5;
        let text, ans;
        if (usePlus) {
          text = `${a} + ${b} = ?`;
          ans = a + b;
        } else {
          const bigger = Math.max(a, b);
          const smaller = Math.min(a, b);
          text = `${bigger} - ${smaller} = ?`;
          ans = bigger - smaller;
        }
        questionEl.textContent = text;
        currentAnswer = ans;
      }

      function endGame() {
        playing = false;
        clearInterval(timerId);
        timerId = null;
        answerInput.disabled = true;
        submitBtn.disabled = true;
        startBtn.disabled = false;
        msg.textContent = `çµ‚äº†ï¼æ­£è§£æ•°ã¯ ${score} å•ã§ã—ãŸã€‚`;
        askNameAndSave("calc", score, true);
      }

      function handleAnswer() {
        if (!playing) return;
        const val = parseInt(answerInput.value, 10);
        if (Number.isNaN(val)) {
          msg.textContent = "æ•°å­—ã§ç­”ãˆã‚’å…¥åŠ›ã—ã¦ã­ã€‚";
          return;
        }
        if (val === currentAnswer) {
          score++;
          msg.textContent = "æ­£è§£ï¼ã„ã„ãƒšãƒ¼ã‚¹ï¼";
        } else {
          msg.textContent = `ãŠã—ã„â€¦ æ­£è§£ã¯ ${currentAnswer} ã§ã—ãŸã€‚`;
        }
        answerInput.value = "";
        updateDisplay();
        makeQuestion();
      }

      startBtn.addEventListener("click", () => {
        playing = true;
        remaining = 30;
        score = 0;
        updateDisplay();
        makeQuestion();
        answerInput.disabled = false;
        submitBtn.disabled = false;
        startBtn.disabled = true;
        msg.textContent = "é›†ä¸­ã—ã¦ã„ã“ã†ï¼";
        answerInput.value = "";
        answerInput.focus();

        if (timerId) clearInterval(timerId);
        timerId = setInterval(() => {
          remaining--;
          updateDisplay();
          if (remaining <= 0) {
            endGame();
          }
        }, 1000);
      });

      submitBtn.addEventListener("click", handleAnswer);
      answerInput.addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
          handleAnswer();
        }
      });
    })();

    // ===== è¨˜æ†¶åŠ›ã‚²ãƒ¼ãƒ  =====
    (function setupMemoryGame() {
      const tiles = Array.from(document.querySelectorAll(".memory-tile"));
      const levelEl = document.getElementById("memory-level");
      const startBtn = document.getElementById("memory-start-btn");
      const msg = document.getElementById("memory-message");

      let sequence = [];
      let userIndex = 0;
      let level = 0;
      let busyShowing = false;
      let playing = false;
      let showTimers = [];

      function clearTimers() {
        showTimers.forEach((id) => clearTimeout(id));
        showTimers = [];
      }

      function setLevelDisplay() {
        levelEl.textContent = level;
      }

      function flashTile(index, delay) {
        const tile = tiles[index];
        const t1 = setTimeout(() => {
          tile.classList.add("active");
        }, delay);
        const t2 = setTimeout(() => {
          tile.classList.remove("active");
        }, delay + 400);
        showTimers.push(t1, t2);
      }

      function showSequence() {
        busyShowing = true;
        msg.textContent = "ã‚ˆãè¦‹ã¦è¦šãˆã¦ã­â€¦";
        clearTimers();
        sequence.forEach((idx, i) => {
          flashTile(idx, i * 600);
        });
        const total = sequence.length * 600;
        const endTimer = setTimeout(() => {
          busyShowing = false;
          msg.textContent = "ä»Šåº¦ã¯åŒã˜é †ç•ªã§ã‚¿ãƒƒãƒ—ã—ã¦ã­ï¼";
        }, total + 500);
        showTimers.push(endTimer);
      }

      function nextRound() {
        level++;
        setLevelDisplay();
        userIndex = 0;
        sequence.push(Math.floor(Math.random() * 4));
        showSequence();
      }

      function gameOver() {
        playing = false;
        clearTimers();
        tiles.forEach((t) => t.classList.remove("active"));
        const score = level;
        msg.textContent = `ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼â€¦ åˆ°é”ãƒ¬ãƒ™ãƒ«ã¯ ${score} ã§ã—ãŸã€‚`;
        startBtn.textContent = "ã‚‚ã†ä¸€å›ï¼";
        askNameAndSave("memory", score, true);
      }

      function startGame() {
        sequence = [];
        level = 0;
        userIndex = 0;
        playing = true;
        busyShowing = false;
        setLevelDisplay();
        msg.textContent = "ã•ã‚ã€ã‚¹ã‚¿ãƒ¼ãƒˆï¼";
        startBtn.textContent = "ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ";
        nextRound();
      }

      startBtn.addEventListener("click", () => {
        if (busyShowing) return;
        startGame();
      });

      tiles.forEach((tile) => {
        tile.addEventListener("click", () => {
          if (!playing || busyShowing) return;
          const idx = parseInt(tile.getAttribute("data-index"), 10);
          const expected = sequence[userIndex];
          if (idx === expected) {
            tile.classList.add("active");
            setTimeout(() => tile.classList.remove("active"), 200);
            userIndex++;
            if (userIndex >= sequence.length) {
              msg.textContent = "ã™ã”ã„ï¼æ¬¡ã®ãƒ¬ãƒ™ãƒ«ã¸ï¼";
              setTimeout(() => {
                nextRound();
              }, 700);
            }
          } else {
            gameOver();
          }
        });
      });
    })();

    // åˆæœŸåŒ–ï¼šãƒ©ãƒ³ã‚­ãƒ³ã‚°èª­ã¿è¾¼ã¿ï¼†æç”»
    loadRankings();
    ["reaction", "calc", "memory"].forEach(renderRanking);
  </script>
</body>
</html>
